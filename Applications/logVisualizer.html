<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Log Flow Architect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false, theme: 'neutral' });
        window.mermaid = mermaid;
    </script>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto space-y-6">
        <header class="text-center space-y-2 relative">
            <a href="../index.html" class="absolute top-0 right-0 bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition-colors">üè† Home</a>
            <h1 class="text-3xl font-bold text-slate-800">AI Log Flow Architect</h1>
            <p class="text-slate-600 italic">Convert complex system logs into interactive mandatory flows</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-col gap-4">
                <div class="flex justify-between items-center">
                    <label class="font-semibold text-slate-700">Paste Logs (Up to 300 lines)</label>
                    <button onclick="loadSample()" class="text-sm text-blue-600 hover:underline">Load Sample Logs</button>
                </div>
                <textarea id="logInput" class="w-full h-96 p-4 font-mono text-xs bg-slate-900 text-green-400 rounded-lg border-none focus:ring-2 focus:ring-blue-500" placeholder="Paste your raw logs here..."></textarea>
                <button id="analyzeBtn" onclick="analyzeLogs()" class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all flex justify-center items-center gap-2">
                    <span>Generate Mandatory Flow</span>
                </button>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <label class="font-semibold text-slate-700">Generated Flowchart</label>
                    <div class="flex items-center gap-2">
                        <button onclick="zoomOut()" class="text-sm px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded">-</button>
                        <span id="zoomLevel" class="text-sm">100%</span>
                        <button onclick="zoomIn()" class="text-sm px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded">+</button>
                        <button onclick="toggleFullscreen()" class="text-sm px-2 py-1 bg-blue-500 text-white hover:bg-blue-600 rounded">‚õ∂</button>
                    </div>
                    <div id="status" class="text-sm text-slate-500">Ready</div>
                </div>
                <div id="outputContainer" class="flex-grow bg-slate-50 rounded-lg overflow-auto border border-dashed border-slate-300 min-h-[400px] flex items-center justify-center">
                    <div id="mermaidOutput" class="p-4"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function loadSample() {
            document.getElementById('logInput').value = `2025-12-19 11:00:01 INFO [Gateway] Initializing transaction request ID: TXN-99812
2025-12-19 11:00:02 INFO [Auth] Validating API Key for Merchant: 'Shopify_Global'
2025-12-19 11:00:03 INFO [Auth] API Key verified successfully
2025-12-19 11:00:04 INFO [Security] Running fraud detection algorithm v4.2
2025-12-19 11:00:05 INFO [Security] IP Address 192.168.4.12 checked against blacklist
2025-12-19 11:00:06 INFO [Security] Fraud score: 0.12 (Low Risk)
2025-12-19 11:00:07 INFO [Order] Parsing JSON payload for items
2025-12-19 11:00:08 INFO [Order] Items validated: [Item_ID: 44, Item_ID: 92]
2025-12-19 11:00:09 INFO [Inventory] Checking stock for Item_ID: 44
2025-12-19 11:00:10 INFO [Inventory] Checking stock for Item_ID: 92
2025-12-19 11:00:11 INFO [Inventory] Stock confirmed for all items
2025-12-19 11:00:12 INFO [Payment] Initiating handshake with Bank_API_Primary
2025-12-19 11:00:13 WARN [Payment] Latency detected on Primary Bank API (800ms)
2025-12-19 11:00:14 INFO [Payment] Encrypting credit card data (AES-256)
2025-12-19 11:00:15 INFO [Payment] Sending authorization request...
2025-12-19 11:00:18 INFO [Payment] Authorization SUCCESS from Bank_API_Primary
2025-12-19 11:00:19 INFO [Ledger] Recording temporary transaction record
2025-12-19 11:00:20 INFO [Notification] Sending web-hook to Merchant URL
2025-12-19 11:00:22 INFO [Cleanup] Closing temporary session TXN-99812
2025-12-19 11:05:01 INFO [Gateway] Initializing transaction request ID: TXN-99813
2025-12-19 11:05:02 INFO [Auth] API Key verified successfully
2025-12-19 11:05:03 INFO [Security] Fraud score: 0.05 (Low Risk)
2025-12-19 11:05:04 INFO [Inventory] Stock confirmed
2025-12-19 11:05:05 INFO [Payment] Initiating handshake with Bank_API_Primary
2025-12-19 11:05:10 WARN [Payment] Bank_API_Primary timeout. Switching to Bank_API_Secondary
2025-12-19 11:05:12 INFO [Payment] Handshake SUCCESS with Bank_API_Secondary
2025-12-19 11:05:15 INFO [Payment] Authorization SUCCESS
2025-12-19 11:05:18 INFO [Gateway] Transaction TXN-99813 COMPLETED
2025-12-19 11:10:01 INFO [Gateway] Initializing transaction request ID: TXN-99814
2025-12-19 11:10:02 INFO [Auth] API Key verified successfully
2025-12-19 11:10:03 INFO [Security] Fraud score: 0.95 (HIGH RISK)
2025-12-19 11:10:04 WARN [Security] Flagging transaction for manual review
2025-12-19 11:10:05 INFO [Payment] REJECTED: Fraud risk too high
2025-12-19 11:10:06 INFO [Gateway] Transaction TXN-99814 DENIED
2025-12-19 11:15:00 INFO [Gateway] Initializing transaction request ID: TXN-99815
2025-12-19 11:15:01 INFO [Auth] API Key verified
2025-12-19 11:15:02 INFO [Order] Parsing JSON payload
2025-12-19 11:15:03 INFO [Inventory] Checking stock...
2025-12-19 11:15:04 INFO [Inventory] Stock confirmed
2025-12-19 11:15:05 INFO [Payment] Handshake with Bank_API_Primary...
2025-12-19 11:15:06 ERROR [Payment] SSL_CERTIFICATE_EXPIRED: Could not establish secure link
2025-12-19 11:15:07 INFO [Payment] Retrying with secondary connection...
2025-12-19 11:15:08 ERROR [Payment] SSL_CERTIFICATE_EXPIRED: Secondary node also failing
2025-12-19 11:15:09 EXCEPTION [Gateway] Fatal Error: System.Security.AuthenticationException
2025-12-19 11:15:10 INFO [Cleanup] Dumping stack trace to crash_logs_99815.txt
2025-12-19 11:20:01 INFO [System] Automated health check starting...
2025-12-19 11:20:02 INFO [Health] CPU Load: 15%
2025-12-19 11:20:03 INFO [Health] Memory Usage: 450MB
2025-12-19 11:20:04 INFO [Health] Database Latency: 5ms
2025-12-19 11:20:05 INFO [Health] Storage: 82% Free
2025-12-19 11:25:01 INFO [Gateway] Initializing transaction request ID: TXN-99816
2025-12-19 11:25:02 INFO [Auth] API Key verified successfully
2025-12-19 11:25:03 INFO [Security] Fraud score: 0.08
2025-12-19 11:25:04 INFO [Order] Parsing JSON payload
2025-12-19 11:25:05 INFO [Inventory] Stock confirmed
2025-12-19 11:25:06 INFO [Payment] Handshake SUCCESS
2025-12-19 11:25:10 INFO [Payment] Authorization SUCCESS
2025-12-19 11:25:12 INFO [Gateway] Transaction TXN-99816 COMPLETED
2025-12-19 11:30:01 INFO [Gateway] Initializing transaction request ID: TXN-99817
2025-12-19 11:30:02 INFO [Auth] API Key verified
2025-12-19 11:30:03 INFO [Security] Fraud score: 0.11
2025-12-19 11:30:04 INFO [Order] Parsing JSON payload
2025-12-19 11:30:05 INFO [Inventory] Stock confirmed
2025-12-19 11:30:06 INFO [Payment] Handshake SUCCESS
2025-12-19 11:30:10 INFO [Payment] Authorization SUCCESS
2025-12-19 11:30:12 INFO [Gateway] Transaction TXN-99817 COMPLETED
2025-12-19 11:35:01 INFO [Gateway] Initializing transaction request ID: TXN-99818
2025-12-19 11:35:02 INFO [Auth] API Key verified
2025-12-19 11:35:03 INFO [Security] Fraud score: 0.15
2025-12-19 11:35:04 INFO [Order] Parsing JSON payload
2025-12-19 11:35:05 INFO [Inventory] Stock confirmed
2025-12-19 11:35:06 INFO [Payment] Handshake SUCCESS
2025-12-19 11:35:10 INFO [Payment] Authorization SUCCESS
2025-12-19 11:35:12 INFO [Gateway] Transaction TXN-99818 COMPLETED
2025-12-19 11:40:01 INFO [Gateway] Initializing transaction request ID: TXN-99819
2025-12-19 11:40:02 INFO [Auth] API Key verified
2025-12-19 11:40:03 INFO [Security] Fraud score: 0.02
2025-12-19 11:40:04 INFO [Order] Parsing JSON payload
2025-12-19 11:40:05 INFO [Inventory] Stock confirmed
2025-12-19 11:40:06 INFO [Payment] Handshake SUCCESS
2025-12-19 11:40:10 INFO [Payment] Authorization SUCCESS
2025-12-19 11:40:12 INFO [Gateway] Transaction TXN-99819 COMPLETED
2025-12-19 11:45:01 INFO [Gateway] Initializing transaction request ID: TXN-99820
2025-12-19 11:45:02 INFO [Auth] API Key verified
2025-12-19 11:45:03 INFO [Security] Fraud score: 0.05
2025-12-19 11:45:04 INFO [Order] Parsing JSON payload
2025-12-19 11:45:05 INFO [Inventory] Stock confirmed
2025-12-19 11:45:06 INFO [Payment] Handshake SUCCESS
2025-12-19 11:45:10 INFO [Payment] Authorization SUCCESS
2025-12-19 11:45:12 INFO [Gateway] Transaction TXN-99820 COMPLETED
2025-12-19 11:50:01 INFO [Gateway] Initializing transaction request ID: TXN-99821
2025-12-19 11:50:02 INFO [Auth] API Key verified
2025-12-19 11:50:03 INFO [Security] Fraud score: 0.01
2025-12-19 11:50:04 INFO [Order] Parsing JSON payload
2025-12-19 11:50:05 INFO [Inventory] Stock confirmed
2025-12-19 11:50:06 INFO [Payment] Handshake SUCCESS
2025-12-19 11:50:10 INFO [Payment] Authorization SUCCESS
2025-12-19 11:50:12 INFO [Gateway] Transaction TXN-99821 COMPLETED
2025-12-19 11:55:00 INFO [System] Maintenance window starting...
2025-12-19 11:55:05 INFO [Backup] Uploading database snapshot to S3
2025-12-19 11:55:10 INFO [Backup] Backup SUCCESS
2025-12-19 11:55:15 INFO [System] Gateway status: SLEEP`;
        }

        async function analyzeLogs() {
            const btn = document.getElementById('analyzeBtn');
            const status = document.getElementById('status');
            const logs = document.getElementById('logInput').value;

            if (!logs) return alert("Please paste some logs first.");

            btn.disabled = true;
            btn.innerHTML = "Processing with AI...";
            status.innerText = "Analyzing logs...";

            const systemPrompt = `You are a Log Architect. Analyze the provided logs and generate a Mermaid.js 'graph TD' flowchart.
            - Focus strictly on the MANDATORY FLOW and sequence.
            - Group repetitive minor steps into single nodes to keep the flow clean (max 15 nodes total).
            - Use simple text labels without special characters like arrows (‚Üí), symbols, or quotes.
            - CRITICAL: If a log contains 'ERROR', 'FAIL', or 'EXCEPTION', name the node 'ERROR_Description' and apply this style: 'style ERROR_Description fill:#fee2e2,stroke:#ef4444,stroke-width:2px'.
            - Return ONLY the Mermaid code block starting with 'graph TD'. No other text.`;

            try {
                const response = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: `Logs to analyze:\n${logs}` }
                        ],
                        model: 'openai', // Pollinations uses high-quality open-source backends
                        seed: 42
                    })
                });

                const aiText = await response.text();
                // Extract mermaid code if AI wrapped it in triple backticks
                const cleanCode = aiText.replace(/```mermaid|```/g, '').trim();
                
                renderDiagram(cleanCode);
                status.innerText = "Success";
            } catch (err) {
                console.error(err);
                status.innerText = "Error analyzing logs";
            } finally {
                btn.disabled = false;
                btn.innerHTML = "Generate Mandatory Flow";
            }
        }

        async function renderDiagram(code) {
            const output = document.getElementById('mermaidOutput');
            output.innerHTML = ''; 
            try {
                const { svg } = await window.mermaid.render('graphDiv', code);
                output.innerHTML = svg;
                // Reset zoom on new render
                currentZoom = 1;
                updateZoom();
            } catch (e) {
                output.innerHTML = `<div class="p-4 text-red-500 bg-red-50 rounded">AI returned invalid Mermaid syntax. Try clicking again.<br><pre class="text-[10px] mt-2">${code}</pre></div>`;
            }
        }

        let currentZoom = 1;
        const zoomStep = 0.1;
        const minZoom = 0.5;
        const maxZoom = 3;

        function updateZoom() {
            const svg = document.querySelector('#mermaidOutput svg');
            if (svg) {
                svg.style.transform = `scale(${currentZoom})`;
                svg.style.transformOrigin = 'top left';
                document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';
            }
        }

        function zoomIn() {
            if (currentZoom < maxZoom) {
                currentZoom += zoomStep;
                updateZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > minZoom) {
                currentZoom -= zoomStep;
                updateZoom();
            }
        }

        function toggleFullscreen() {
            const container = document.getElementById('outputContainer');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }
    </script>
</body>
</html>