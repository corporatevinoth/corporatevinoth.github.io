<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Shooter Runner - Collect Gold Coins</title>
  <style>
    body { margin: 0; overflow: hidden; background: linear-gradient(135deg,#00e2ff 0%,#ff96f9 100%);}
    #score {
      position: absolute;
      top: 24px;
      left: 0;
      right: 0;
      color: #fff700;
      font-family: 'Arial Black', Arial, sans-serif;
      font-size: 2em;
      text-align: center;
      text-shadow: 2px 2px 8px #333;
      z-index: 10;
      letter-spacing: 2px;
    }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    // --- SETUP ---
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 500);
    let renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    let light = new THREE.DirectionalLight(0xffffff, 1.2);
    light.position.set(0, 20, 15);
    scene.add(light);
    let ambLight = new THREE.AmbientLight(0xf3e5ab, 0.8);
    scene.add(ambLight);

    // --- ROAD ---
    let roads = [];
    function createRoad(z) {
      let color = new THREE.Color(`hsl(${Math.floor(180+z*2)%360},90%,60%)`);
      let mat = new THREE.MeshPhongMaterial({color, shininess:30});
      let geo = new THREE.BoxGeometry(14, 0.8, 70);
      let mesh = new THREE.Mesh(geo, mat);
      mesh.position.set(0, -0.5, z);
      scene.add(mesh);
      roads.push(mesh);
    }
    for(let i=0;i<3;i++) createRoad(i*70);

    // --- PLAYER ---
    let playerGeo = new THREE.CapsuleGeometry(1.1, 2.2, 8, 16);
    let playerMat = new THREE.MeshPhongMaterial({color:0x00ffcc, shininess:90, emissive:0x1fffff, emissiveIntensity:0.1});
    let player = new THREE.Mesh(playerGeo, playerMat);
    player.position.set(0, 2, 0);
    scene.add(player);

    // --- COINS ---
    let coins = [], coinYAnim = 0;
    function createCoin(x, z) {
      let geo = new THREE.TorusGeometry(0.7, 0.25, 16, 32);
      let mat = new THREE.MeshPhongMaterial({color:0xffd700, shininess:120, emissive:0xffff00, emissiveIntensity:0.4});
      let coin = new THREE.Mesh(geo, mat);
      coin.position.set(x, 1.7, z);
      coin.rotation.x = Math.PI/2;
      scene.add(coin);
      coins.push(coin);
    }
    function spawnCoins(startZ) {
      for (let i = 0; i < 7; i++) {
        let lane = [-4, 0, 4][Math.floor(Math.random()*3)];
        createCoin(lane, startZ + 15 + i*7 + Math.random()*5);
      }
    }
    spawnCoins(0);

    // --- ENVIRONMENT (Colorful Poles/Sky) ---
    for (let i=0;i<32;i++) {
      let color = new THREE.Color(`hsl(${Math.floor(i*25)%360},100%,60%)`);
      let poleMat = new THREE.MeshPhongMaterial({color});
      let pole = new THREE.Mesh(new THREE.CylinderGeometry(0.4,0.7,18,12), poleMat);
      let x = (i%2==0)? -8.5 : 8.5;
      pole.position.set(x, 9, i*18-40);
      scene.add(pole);
    }

    // --- GAME STATE ---
    let lane = 1; // 0:left 1:center 2:right
    let lanes = [-4, 0, 4];
    let targetLane = 1;
    let speed = 0.48;
    let score = 0;
    let scoreDiv = document.getElementById("score");

    // --- INPUT ---
    window.addEventListener('keydown', e=>{
      if (e.key==='ArrowLeft'||e.key==='a') targetLane=Math.max(0,targetLane-1);
      if (e.key==='ArrowRight'||e.key==='d') targetLane=Math.min(2,targetLane+1);
    });

    // --- GAME LOOP ---
    function animate() {
      // Move player forward
      player.position.z += speed;

      // Smooth lane change
      let tx = lanes[targetLane];
      player.position.x += (tx-player.position.x)*0.25;

      // Animate player up/down (run bob)
      player.position.y = 2 + Math.sin(Date.now()/120)*0.14;

      // Camera follows behind and above
      camera.position.lerp(
        new THREE.Vector3(player.position.x, player.position.y+7, player.position.z-12),
        0.12
      );
      camera.lookAt(player.position.x, 2, player.position.z+18);

      // Move/loop road
      for (let road of roads) {
        if (road.position.z + 35 < player.position.z-35) {
          road.position.z += 210; // 3*70
        }
      }

      // Coin animation and collision
      coinYAnim += 0.09;
      for (let coin of coins) {
        coin.position.y = 1.7 + Math.sin(coin.position.z+coinYAnim)*0.22;
        coin.rotation.z += 0.08;
      }

      // Coin collection
      for (let i=coins.length-1; i>=0; i--) {
        let coin = coins[i];
        if (
          Math.abs(coin.position.z - player.position.z)<1.9 &&
          Math.abs(coin.position.x - player.position.x)<2.1
        ) {
          scene.remove(coin);
          coins.splice(i,1);
          score++;
          scoreDiv.innerText = "Score: "+score;
          // Vibrant effect on collection
          document.body.style.background = `linear-gradient(135deg,hsl(${Math.random()*360},100%,65%),hsl(${Math.random()*360},100%,70%))`;
        }
      }

      // Spawn more coins if needed
      if (coins.length<7) spawnCoins(player.position.z+30);

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    // --- Responsive ---
    window.addEventListener('resize', ()=>{
      camera.aspect=window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>