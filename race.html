<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Race Game</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { background: #222; display: block; margin: 0 auto; }
    #controls { display: none; position: fixed; bottom: 40px; left: 0; width: 100%; text-align: center; }
    #controls button { font-size: 2em; margin: 0 20px; }
    @media (pointer: coarse) {
      #controls { display: block; }
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="controls">
  <button id="leftBtn">⬅️</button>
  <button id="rightBtn">➡️</button>
</div>
<script>
const carImages = [
  'bluecar.jpg', 'greencar.png', 'jeep.png', 'purplecar.png', 'truck.png'
];
const playerCarImage = 'redcar.jpg';
const carWidth = 60, carHeight = 100;
let cars = [];
let player = { x: 0, y: 0, img: null };
let canvas = document.getElementById('gameCanvas');
let ctx = canvas.getContext('2d');

// Added for road animation
let roadLineOffset = 0;
const roadLineSpeed = 10;

// Responsive sizing
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  player.x = canvas.width/2 - carWidth/2;
  player.y = canvas.height - carHeight - 30;
}
window.addEventListener('resize', resize);

// Load images
function loadImage(src) {
  const img = new Image();
  img.src = src;
  return img;
}
let loadedImages = { player: loadImage(playerCarImage) };
carImages.forEach((src, i) => loadedImages[i] = loadImage(src));

// Draw road with animated dotted center line
function drawRoad() {
  // Black road
  ctx.fillStyle = 'black';
  ctx.fillRect(canvas.width/4, 0, canvas.width/2, canvas.height);

  // Dotted white center line (animated)
  ctx.strokeStyle = 'white';
  ctx.lineWidth = 6;
  ctx.setLineDash([30, 30]);
  ctx.beginPath();
  ctx.moveTo(canvas.width/2, -roadLineOffset % 60);
  ctx.lineTo(canvas.width/2, canvas.height);
  ctx.stroke();
  ctx.setLineDash([]);
}

// Draw cars
function drawCars() {
  cars.forEach(car => {
    ctx.drawImage(loadedImages[car.imgIdx], car.x, car.y, carWidth, carHeight);
  });
}
function drawPlayer() {
  ctx.drawImage(loadedImages.player, player.x, player.y, carWidth, carHeight);
}

// Game loop
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  roadLineOffset += roadLineSpeed;
  drawRoad();

  // Move cars
  cars.forEach(car => {
    car.y += car.speed;
    // If car goes off screen, reset to top in random lane
    if (car.y > canvas.height) {
      car.y = -carHeight;
      car.x = canvas.width/4 + Math.floor(Math.random() * 3)*(canvas.width/2- carWidth)/2;
    }
  });

  drawCars();
  drawPlayer();
  requestAnimationFrame(gameLoop);
}

// Controls
function movePlayer(dir) {
  const roadLeft = canvas.width/4;
  const roadRight = canvas.width*3/4 - carWidth;
  if (dir === 'left') player.x = Math.max(roadLeft, player.x - 30);
  if (dir === 'right') player.x = Math.min(roadRight, player.x + 30);
}
window.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') movePlayer('left');
  if (e.key === 'ArrowRight') movePlayer('right');
});
// Mobile controls
document.getElementById('leftBtn').addEventListener('click', () => movePlayer('left'));
document.getElementById('rightBtn').addEventListener('click', () => movePlayer('right'));

// Initialize
function init() {
  resize();
  // Place cars randomly, each with speed
  cars = [];
  for (let i = 0; i < 5; ++i) {
    const lane = Math.floor(Math.random() * 3);
    const x = canvas.width/4 + lane*(canvas.width/2- carWidth)/2;
    cars.push({
      x: x,
      y: 100 + i*150,
      imgIdx: i,
      speed: 5 + Math.random()*3 // random speed for each car
    });
  }
  player.x = canvas.width/2 - carWidth/2;
  player.img = loadedImages.player;
  gameLoop();
}
window.onload = init;
</script>
</body>
</html>
