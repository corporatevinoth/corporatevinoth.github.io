<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Balloon Shooter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body { margin:0; padding:0; overflow: hidden; background: #b3e5fc; height: 100%; width: 100%; }
    #score {
      position: absolute; top: 16px; left: 20px; color: #fff; font-size: 1.5rem;
      background: rgba(44,83,100,0.6); border-radius: 10px; padding: 7px 22px; z-index: 2;
      font-family: Arial, sans-serif; letter-spacing: 1.5px; box-shadow: 0 2px 16px #0003;
    }
    #info {
      position: absolute; top: 16px; left: 50%; transform: translateX(-50%);
      color: #fff; font-size: 1rem;
      background: rgba(0,0,0,0.25); border-radius: 10px; padding: 7px 16px; z-index: 2;
      font-family: Arial, sans-serif; letter-spacing: 0.5px; box-shadow: 0 2px 12px #0001;
    }
    canvas { display:block; }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <div id="info">Tap or Click Balloons! | Machine gun auto-shoots!</div>
  <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
  <script>
    let scene, camera, renderer, gun, balloons = [], bullets = [], score = 0;

    // Setup Three.js
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 0, 18);

    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    const sun = new THREE.DirectionalLight(0xffffff, 0.8);
    sun.position.set(0, 2, 4);
    scene.add(sun);
    const amb = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(amb);

    // Sky
    const skyGeo = new THREE.SphereGeometry(200,32,32);
    const skyMat = new THREE.MeshBasicMaterial({color: 0xb3e5fc, side:THREE.BackSide});
    const sky = new THREE.Mesh(skyGeo, skyMat);
    scene.add(sky);

    // Gun Model
    function createGun() {
      const gunGroup = new THREE.Group();
      const body = new THREE.Mesh(
        new THREE.BoxGeometry(1.8, 0.5, 0.5),
        new THREE.MeshPhongMaterial({color: 0x333333})
      );
      const barrel = new THREE.Mesh(
        new THREE.CylinderGeometry(0.13, 0.13, 1.1, 16),
        new THREE.MeshPhongMaterial({color: 0x607d8b})
      );
      barrel.rotation.z = Math.PI / 2;
      barrel.position.set(1.1, 0, 0);
      const muzzle = new THREE.Mesh(
        new THREE.SphereGeometry(0.17, 12, 12),
        new THREE.MeshPhongMaterial({color: 0xffab00})
      );
      muzzle.position.set(1.65, 0, 0);
      gunGroup.add(body);
      gunGroup.add(barrel);
      gunGroup.add(muzzle);
      gunGroup.position.set(0, -8.5, 0);
      return gunGroup;
    }
    gun = createGun();
    scene.add(gun);

    // Balloon
    function createBalloon() {
      const colors = [0xff1744, 0xffea00, 0x00e676, 0x2979ff, 0xd500f9, 0xff9100];
      const color = colors[Math.floor(Math.random() * colors.length)];
      const geometry = new THREE.SphereGeometry(0.65, 24, 24);
      geometry.scale(1, 1.25, 1);
      const material = new THREE.MeshPhongMaterial({color, shininess: 90, specular: 0xffffff});
      const balloon = new THREE.Mesh(geometry, material);
      balloon.position.x = (Math.random() - 0.5) * 10;
      balloon.position.y = -9;
      balloon.position.z = (Math.random() - 0.5) * 3;
      balloon.userData = { speed: 0.018 + Math.random()*0.012, popping: false };
      const lineMat = new THREE.LineBasicMaterial({ color: 0x333 });
      const points = [ new THREE.Vector3(0, -1.1, 0), new THREE.Vector3(0, -2.2, 0) ];
      const line = new THREE.Line(new THREE.BufferGeometry().setFromPoints(points), lineMat);
      balloon.add(line);
      return balloon;
    }

    function spawnBalloon() {
      const balloon = createBalloon();
      scene.add(balloon);
      balloons.push(balloon);
    }

    setInterval(() => {
      if (balloons.length < 12) spawnBalloon();
    }, 600);

    // Bullets
    function createBullet() {
      const geometry = new THREE.CylinderGeometry(0.09, 0.09, 0.7, 10);
      const material = new THREE.MeshPhongMaterial({color: 0xffff00, shininess: 90});
      const bullet = new THREE.Mesh(geometry, material);
      bullet.rotation.z = Math.PI/2;
      bullet.position.set(gun.position.x + 1.1, gun.position.y + 0.1, 0); // Just ahead of barrel
      bullet.userData = { speed: 0.57, alive: true };
      return bullet;
    }

    setInterval(() => {
      bullets.push(createBullet());
      scene.add(bullets[bullets.length-1]);
    }, 90);

    // Collision
    function checkBulletBalloonCollisions() {
      for (let i = bullets.length-1; i >= 0; i--) {
        const bullet = bullets[i];
        bullet.position.x += bullet.userData.speed;
        if (bullet.position.x > 13) {
          scene.remove(bullet);
          bullets.splice(i,1);
          continue;
        }
        for (let j = balloons.length-1; j >= 0; j--) {
          const balloon = balloons[j];
          if (balloon.userData.popping) continue;
          const dist = bullet.position.distanceTo(balloon.position);
          if (dist < 1.2) {
            balloon.userData.popping = true;
            score++;
            document.getElementById('score').textContent = 'Score: ' + score;
            scene.remove(bullet);
            bullets.splice(i,1);
            break;
          }
        }
      }
    }

    // Animate
    function animate() {
      requestAnimationFrame(animate);
      for (let i = balloons.length-1; i >= 0; i--) {
        let b = balloons[i];
        if (b.userData.popping) {
          b.scale.multiplyScalar(1.13);
          b.material.opacity = (b.material.opacity||1) * 0.80;
          b.material.transparent = true;
          if (b.scale.x > 2.2) {
            scene.remove(b);
            balloons.splice(i,1);
          }
        } else {
          b.position.y += b.userData.speed;
          b.rotation.y += 0.01;
          if (b.position.y > 11) {
            scene.remove(b);
            balloons.splice(i,1);
          }
        }
      }
      checkBulletBalloonCollisions();
      renderer.render(scene, camera);
    }
    animate();

    // Responsive
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>